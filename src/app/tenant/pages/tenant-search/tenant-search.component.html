<ocx-portal-page permission="TENANT#SEARCH" helpArticleId="PAGE_TENANT_SEARCH" *ngrxLet="viewModel$; let vm">
  <ocx-search-header
    [headline]="'TENANT_SEARCH.HEADER' | translate"
    [subheader]="'TENANT_SEARCH.SUB_HEADER' | translate"
    (searched)="onSearch(tenantSearchForm)"
    (resetted)="onResetSearchCriteria()"
    [manualBreadcrumbs]="false"
    [actions]="(headerActions$ | async) ?? []"
    searchConfigPermission="SEARCHCONFIG#USE"
    [viewMode]="vm.viewMode"
    pageName="PAGE_TENANT_SEARCH"
    (viewModeChanged)="viewModeChanged($event)"
    (selectedSearchConfigChanged)="searchConfigInfoSelectionChanged($event)"
  >
    <div [formGroup]="tenantSearchForm" class="flex flex-row flex-wrap gap-3">
      <span class="p-float-label">
        <input
          pInputText
          id="tm_search_orgId"
          type="text"
          class="w-15rem"
          formControlName="orgId"
          [attr.aria-label]="'TENANT_SEARCH.CRITERIA.ORGID' | translate"
          [pTooltip]="'TENANT_SEARCH.TOOLTIPS.ORGID' | translate"
          tooltipPosition="top"
          tooltipEvent="hover"
        />
        <label for="tm_search_orgId" class="text-responsive"> {{ 'TENANT_SEARCH.CRITERIA.ORGID' | translate }} </label>
      </span>
    </div>
  </ocx-search-header>

  <ocx-content-container layout="horizontal">
    <ocx-content class="w-full no-card-padding">
      <ocx-interactive-data-view
        editPermission="ADMIN#EDIT"
        [data]="(filteredResults$ | async) || []"
        [columns]="vm.columns"
        viewPermission="TENANT#VIEW"
        searchConfigPermission="SEARCHCONFIG#USE"
        [listGridPaginator]="true"
        [emptyResultsMessage]="'TENANT_SEARCH.EMPTY_RESULTS' | translate"
        [supportedViewLayouts]="['list', 'grid']"
        [layout]="layout"
        (displayedColumnsChange)="onDisplayedColumnsChange($event)"
        [defaultGroupKey]="'TENANT_SEARCH.PREDEFINED_GROUP.DEFAULT'"
        [pageSizes]="[10, 50, 1000]"
      >
        <ng-template #topCenter>
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon">
              <i class="pi pi-filter"></i>
            </span>
            <input
              pInputText
              [formControl]="tenantFilterFormControl"
              [placeholder]="'TENANT_SEARCH.FILTER.PLACEHOLDER' | translate"
            />
            <button
              pButton
              type="button"
              icon="pi pi-filter-slash"
              class="p-button-primary"
              (click)="clearTextFilters()"
              [disabled]="!tenantFilterFormControl.value"
              [pTooltip]="'TENANT_SEARCH.FILTER.CLEAR' | translate"
              tooltipPosition="top"
            ></button>
          </div>
        </ng-template>
        <ng-template #gridItem let-item>
          <p-card class="grid-item-card">
            <ng-template pTemplate="header">
              <span class="grid-item-title" (click)="handleOpenEntryDetails(item)">{{
                item['tenantId'] | titlecase
              }}</span>
            </ng-template>
            <div class="grid-item-content" (click)="handleOpenEntryDetails(item)">
              @if (showDefaultIcon(item['id'])) {
                <span class="pi pi-image image-container default-icon"></span>
              }
              <img
                *ngIf="!showDefaultIcon(item['id'])"
                class="image-container"
                (error)="imageLoadFailed(item['id'])"
                (load)="imageLoaded(item['id'])"
                [ocxSrc]="getImageUrl(item['id'])"
                alt="Tenant logo"
              />
              <div>
                <span>Org ID: </span>
                <span>{{ item['orgId'] }}</span>
              </div>
              <div>
                <span>{{ item['description'] }}</span>
              </div>
            </div>
            <ng-template pTemplate="footer" *ocxIfPermission="'ADMIN#EDIT'">
              <p-toast />
              <p-menu #menu [model]="cardMenuItems" [popup]="true" appendTo="body" />
              <p-button (onClick)="openMenu(menu, $event, item)" icon="pi pi-ellipsis-v" />
            </ng-template>
          </p-card>
        </ng-template>
        <ng-template #listItem let-item let-i="rowIndex">
          <article
            class="list-item-row"
            [ngClass]="{ 'list-item-row-even': i % 2 === 0 }"
            [id]="'tm_search_data_list_row_' + i"
            [attr.aria-label]="item['tenantId']"
          >
            <div class="list-item-image" [id]="'tm_search_data_list_row_' + i + '_logo'">
              @if (showDefaultIcon(item['id'])) {
                <span class="pi pi-image list-item-default-icon" aria-hidden="true"></span>
              }
              <img
                *ngIf="!showDefaultIcon(item['id'])"
                class="list-item-logo"
                (error)="imageLoadFailed(item['id'])"
                (load)="imageLoaded(item['id'])"
                [ocxSrc]="getImageUrl(item['id'])"
                alt="Tenant logo"
                aria-hidden="true"
              />
            </div>
            <div
              [id]="'tm_search_data_list_row_' + i + '_tenant_id'"
              class="list-item-tenant-id"
              aria-label="Tenant ID"
              [pTooltip]="item['tenantId']"
              tooltipPosition="top"
              tooltipEvent="hover"
              role="note"
            >
              {{ item['tenantId'] }}
            </div>
            <div
              [id]="'tm_search_data_list_row_' + i + '_org_id'"
              class="list-item-org-id"
              aria-label="Organization ID"
              [pTooltip]="item['orgId']"
              tooltipPosition="top"
              tooltipEvent="hover"
              role="note"
            >
              {{ item['orgId'] }}
            </div>
            <div
              [id]="'tm_search_data_list_row_' + i + '_description'"
              class="list-item-description"
              [attr.aria-label]="'TENANT_SEARCH.COLUMNS.DESCRIPTION' | translate"
              [pTooltip]="item['description'] && item['description'].length > 50 ? item['description'] : ''"
              tooltipPosition="top"
              tooltipEvent="hover"
              role="note"
            >
              {{ item['description'] }}
            </div>
            <div
              [id]="'tm_search_data_list_row_' + i + '_modification_date'"
              class="list-item-modification-date"
              aria-label="Modification Date"
              tooltipPosition="top"
              tooltipEvent="hover"
              role="note"
            >
              {{ item['modificationDate'] | date: 'short' }}
            </div>
            <div
              [id]="'tm_search_data_list_row_' + i + '_creation_date'"
              class="list-item-creation-date"
              aria-label="Creation Date"
              tooltipPosition="top"
              tooltipEvent="hover"
              role="note"
            >
              {{ item['creationDate'] | date: 'short' }}
            </div>
            <div class="list-item-actions">
              <p-button
                [id]="'tm_search_data_list_row_' + i + '_view_button'"
                icon="pi pi-eye"
                [pTooltip]="'ACTIONS.VIEW.TOOLTIP' | translate"
                tooltipPosition="top"
                (onClick)="handleOpenEntryDetails(item)"
                styleClass="p-button-sm p-button-text"
                [attr.aria-label]="'ACTIONS.VIEW.LABEL' | translate"
              />
              <p-button
                *ocxIfPermission="'ADMIN#EDIT'"
                [id]="'tm_search_data_list_row_' + i + '_edit_button'"
                icon="pi pi-pencil"
                [pTooltip]="'ACTIONS.EDIT.TOOLTIP' | translate"
                tooltipPosition="top"
                (onClick)="handleEditEntry(item)"
                styleClass="p-button-sm p-button-text"
                [attr.aria-label]="'ACTIONS.EDIT.LABEL' | translate"
              />
            </div>
          </article>
        </ng-template>
      </ocx-interactive-data-view>
    </ocx-content>

    <ocx-content class="w-full xl:w-3" *ngIf="vm.results.length > 0 && vm.chartVisible && (diagramColumn$ | async)">
      <div class="flex flex-column md:flex-row lg:flex-column justify-content-center">
        <ocx-group-by-count-diagram
          *ngIf="diagramColumn$ | async as diagramColumn"
          [data]="vm.results"
          [column]="diagramColumn"
          sumKey="TENANT_SEARCH.DIAGRAM.SUM"
        ></ocx-group-by-count-diagram>
      </div>
    </ocx-content>
  </ocx-content-container>
</ocx-portal-page>
